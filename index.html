<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My GitHub Page</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js"></script>

  <style>
    /* Your original CSS goes here — omitted for brevity */
  </style>
</head>
<body>

  <header>
    <h1>Welcome to My GitHub Page</h1>
    <nav>
      <a href="#about">About</a>
      <a href="#projects">Projects</a>
      <a href="#post">Post</a>
    </nav>
  </header>

  <div class="page-content">
    <div class="left-column">
      <section id="about">
        <h2>About Me</h2>
        <p>Hello! I'm a developer passionate about open-source, clean code, and creative UI design.</p>
      </section>
      <section id="projects">
        <h2>Projects</h2>
        <ul></ul>
      </section>
    </div>

    <div class="right-column">
      <section id="post">
        <h2>Create a Post</h2>
        <div id="authSection">
          <input type="password" id="postPassword" placeholder="Enter password to post">
          <button onclick="unlockPostForm()">Unlock</button>
        </div>

        <form id="postForm" style="display:none;">
          <input type="text" id="postTitle" placeholder="Post Title" required>
          <textarea id="postContent" rows="5" placeholder="Write something..." required></textarea>
          <input type="file" id="postImage" accept="image/*">
          <button type="submit">Publish</button>
        </form>

        <div id="postsContainer"></div>
      </section>
    </div>
  </div>

  <footer>
    &copy; 2025 Henry Park – Built with GitHub Pages
  </footer>

  <script>
    // Initialize Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyCraxKhubAnCTGHqKuCoKRWK8tTtzANGoA",
      authDomain: "githubpage-8c5c3.firebaseapp.com",
      projectId: "githubpage-8c5c3",
      storageBucket: "githubpage-8c5c3.firebasestorage.app",
      messagingSenderId: "142580769287",
      appId: "1:142580769287:web:4fdbd7caa1e2b41174c0a2",
      measurementId: "G-GX3MX9H6SJ"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const PASSWORD = "KRaPYrnEH12121206";
    const form = document.getElementById('postForm');
    const postsContainer = document.getElementById('postsContainer');

    window.addEventListener('DOMContentLoaded', async () => {
      const snapshot = await db.collection('posts').orderBy('timestamp', 'desc').get();
      snapshot.forEach(doc => {
        const post = doc.data();
        post.id = doc.id;
        renderPost(post);
      });
    });

    function unlockPostForm() {
      const inputPass = document.getElementById('postPassword').value;
      if (inputPass === PASSWORD) {
        document.getElementById('authSection').style.display = 'none';
        form.style.display = 'flex';
      } else {
        alert('❌ Incorrect password.');
      }
    }

    form.addEventListener('submit', async function(event) {
      event.preventDefault();

      const title = document.getElementById('postTitle').value;
      const content = document.getElementById('postContent').value;
      const imageInput = document.getElementById('postImage');
      const time = new Date().toLocaleString();

      const newPost = {
        title,
        content,
        timestamp: time,
        image: '',
        comments: []
      };

      if (imageInput.files && imageInput.files[0]) {
        const reader = new FileReader();
        reader.onload = async function(e) {
          newPost.image = e.target.result;
          const docRef = await db.collection('posts').add(newPost);
          newPost.id = docRef.id;
          renderPost(newPost);
        };
        reader.readAsDataURL(imageInput.files[0]);
      } else {
        const docRef = await db.collection('posts').add(newPost);
        newPost.id = docRef.id;
        renderPost(newPost);
      }

      form.reset();
    });

    async function deletePost(postId, postDiv) {
      const confirmDelete = confirm("⚠️ Are you sure you want to delete this post?");
      if (confirmDelete) {
        await db.collection('posts').doc(postId).delete();
        postDiv.remove();
      }
    }

    function renderPost(post) {
      const postDiv = document.createElement('div');
      postDiv.className = 'post';

      const titleEl = document.createElement('h3');
      titleEl.textContent = post.title;

      const contentEl = document.createElement('p');
      contentEl.textContent = post.content;

      const timestampEl = document.createElement('div');
      timestampEl.className = 'timestamp';
      timestampEl.textContent = `Posted on ${post.timestamp}`;

      const deleteBtn = document.createElement('button');
      deleteBtn.className = 'delete-btn';
      deleteBtn.innerHTML = '<i class="fas fa-trash"></i>';
      deleteBtn.onclick = () => deletePost(post.id, postDiv);

      postDiv.appendChild(deleteBtn);
      postDiv.appendChild(titleEl);
      postDiv.appendChild(contentEl);

      if (post.image) {
        const img = document.createElement('img');
        img.src = post.image;
        postDiv.appendChild(img);
      }

      postDiv.appendChild(timestampEl);

      const commentsContainer = document.createElement('div');
      commentsContainer.className = 'comments';

      const commentsList = document.createElement('ul');
      commentsList.style.paddingLeft = '20px';

      if (post.comments && post.comments.length > 0) {
        post.comments.forEach(comment => {
          const li = document.createElement('li');
          li.textContent = comment;
          commentsList.appendChild(li);
        });
      }

      const commentForm = document.createElement('form');
      commentForm.style.marginTop = '10px';
      commentForm.innerHTML = `
        <input type="text" placeholder="Add a comment..." required style="width: 70%; padding: 5px; margin-right: 5px;">
        <button type="submit" style="padding: 5px 10px;">Post</button>
      `;

      commentForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const input = commentForm.querySelector('input');
        const comment = input.value.trim();
        if (comment) {
          const li = document.createElement('li');
          li.textContent = comment;
          commentsList.appendChild(li);
          input.value = '';

          const postRef = db.collection('posts').doc(post.id);
          const doc = await postRef.get();
          const currentComments = doc.exists ? doc.data().comments || [] : [];
          currentComments.push(comment);
          await postRef.update({ comments: currentComments });
        }
      });

      commentsContainer.appendChild(commentsList);
      commentsContainer.appendChild(commentForm);
      postDiv.appendChild(commentsContainer);

      postsContainer.prepend(postDiv);
    }
  </script>
</body>
</html>
